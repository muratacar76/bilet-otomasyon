@model dynamic?

@{
    ViewData["Title"] = "Rezervasyon Y√∂netimi - BULUTBƒ∞LET.COM";
}

<div class="container">
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger" style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); color: white; padding: 16px; border-radius: 12px; margin-bottom: 24px; border: none;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div style="font-size: 24px;">‚ö†Ô∏è</div>
                <div>
                    <strong>Hata:</strong> @TempData["Error"]
                </div>
            </div>
            <div style="margin-top: 12px;">
                <a asp-action="Query" class="btn btn-light" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">
                    üîç Yeni Sorgulama Yap
                </a>
            </div>
        </div>
    }

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success" style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; padding: 16px; border-radius: 12px; margin-bottom: 24px; border: none;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div style="font-size: 24px;">‚úÖ</div>
                <div>
                    <strong>Ba≈üarƒ±lƒ±:</strong> @TempData["Success"]
                </div>
            </div>
        </div>
    }

    @if (Model != null)
    {
        var modelType = Model.GetType();
        var bookingObj = modelType.GetProperty("Booking")?.GetValue(Model);
        var flight = modelType.GetProperty("Flight")?.GetValue(Model);
        var passengers = modelType.GetProperty("Passengers")?.GetValue(Model);
        var user = modelType.GetProperty("User")?.GetValue(Model);
        
        // Booking properties
        var bookingType = bookingObj?.GetType();
        var bookingId = bookingType?.GetProperty("Id")?.GetValue(bookingObj)?.ToString() ?? "0";
        var bookingReference = bookingType?.GetProperty("BookingReference")?.GetValue(bookingObj)?.ToString() ?? "N/A";
        var status = bookingType?.GetProperty("Status")?.GetValue(bookingObj)?.ToString() ?? "Unknown";
        var totalPrice = bookingType?.GetProperty("TotalPrice")?.GetValue(bookingObj)?.ToString() ?? "0";
        var bookingDate = (DateTime)(bookingType?.GetProperty("BookingDate")?.GetValue(bookingObj) ?? DateTime.Now);
        var isPaid = (bool)(bookingType?.GetProperty("IsPaid")?.GetValue(bookingObj) ?? false);
        var canBeCancelled = (bool)(bookingType?.GetProperty("CanBeCancelled")?.GetValue(bookingObj) ?? false);

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2>üé´ Rezervasyon Detaylarƒ±</h2>
                <div style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600;">
                    ‚úÖ @status
                </div>
            </div>

            <!-- PNR Bilgisi -->
            <div style="background: linear-gradient(135deg, #00bcd4 0%, #00acc1 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 24px; text-align: center;">
                <h3 style="margin-bottom: 8px; font-size: 18px;">Rezervasyon Numarasƒ± (PNR)</h3>
                <div style="font-size: 32px; font-weight: 800; font-family: monospace; letter-spacing: 4px;">
                    @bookingReference
                </div>
                <small style="opacity: 0.9;">Bu numarayƒ± check-in i≈ülemlerinde kullanabilirsiniz</small>
            </div>

            <!-- U√ßu≈ü Bilgileri -->
            <div class="card" style="margin-bottom: 24px;">
                <h3>‚úàÔ∏è U√ßu≈ü Bilgileri</h3>
                <div class="flight-info-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px;">
                    <div>
                        <div class="info-item">
                            <strong>U√ßu≈ü Numarasƒ±:</strong> @flight.FlightNumber
                        </div>
                        <div class="info-item">
                            <strong>Havayolu:</strong> @flight.Airline
                        </div>
                        <div class="info-item">
                            <strong>Rota:</strong> @flight.DepartureCity ‚Üí @flight.ArrivalCity
                        </div>
                    </div>
                    <div>
                        <div class="info-item">
                            <strong>Kalkƒ±≈ü:</strong> @flight.DepartureTime.ToString("dd.MM.yyyy HH:mm")
                        </div>
                        <div class="info-item">
                            <strong>Varƒ±≈ü:</strong> @flight.ArrivalTime.ToString("dd.MM.yyyy HH:mm")
                        </div>
                        <div class="info-item">
                            <strong>S√ºre:</strong> @((flight.ArrivalTime - flight.DepartureTime).Hours)s @((flight.ArrivalTime - flight.DepartureTime).Minutes)dk
                        </div>
                    </div>
                </div>
            </div>

            <!-- Yolcu Bilgileri -->
            <div class="card" style="margin-bottom: 24px;">
                <h3>üë• Yolcu Bilgileri</h3>
                <div class="passengers-grid" style="display: grid; gap: 16px; margin-top: 16px;">
                    @foreach (var passenger in passengers)
                    {
                        <div style="border: 1px solid #e0e0e0; padding: 16px; border-radius: 8px; background: #f8f9fa;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>@passenger.FirstName @passenger.LastName</strong>
                                    <div style="font-size: 14px; color: #666; margin-top: 4px;">
                                        TC: @passenger.IdentityNumber | Tel: @passenger.PhoneNumber
                                    </div>
                                </div>
                                @if (!string.IsNullOrEmpty(passenger.SeatNumber))
                                {
                                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                        ü™ë @passenger.SeatNumber
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>

            <!-- √ñdeme Bilgileri -->
            <div class="card" style="margin-bottom: 24px;">
                <h3>üí≥ √ñdeme Bilgileri</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px;">
                    <div>
                        <div class="info-item">
                            <strong>Toplam Tutar:</strong> ‚Ç∫@totalPrice
                        </div>
                        <div class="info-item">
                            <strong>Rezervasyon Tarihi:</strong> @bookingDate.ToString("dd.MM.yyyy HH:mm")
                        </div>
                    </div>
                    <div>
                        <div class="info-item">
                            <strong>√ñdeme Durumu:</strong> 
                            @if (isPaid)
                            {
                                <span style="color: #4caf50; font-weight: 600;">‚úÖ √ñdendi</span>
                            }
                            else
                            {
                                <span style="color: #ff9800; font-weight: 600;">‚è≥ √ñdeme Bekliyor</span>
                            }
                        </div>
                        @if (isPaid)
                        {
                            <div class="info-item">
                                <strong>√ñdeme Tarihi:</strong> √ñdeme tamamlandƒ±
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- ƒ∞leti≈üim Bilgileri -->
            <div class="card" style="margin-bottom: 24px;">
                <h3>üìß ƒ∞leti≈üim Bilgileri</h3>
                <div class="info-item">
                    <strong>E-posta:</strong> @user.Email
                </div>
                @if (!string.IsNullOrEmpty(user.PhoneNumber))
                {
                    <div class="info-item">
                        <strong>Telefon:</strong> @user.PhoneNumber
                    </div>
                }
            </div>

            <!-- ƒ∞≈ülem Butonlarƒ± -->
            <div style="display: flex; gap: 16px; justify-content: center; margin-top: 32px;">
                @if (!isPaid)
                {
                    <button class="btn btn-success" onclick="processPayment('@bookingReference')" style="padding: 12px 24px; font-size: 16px;">
                        üí≥ √ñdeme Yap
                    </button>
                }
                
                @if (canBeCancelled)
                {
                    <button class="btn btn-danger" onclick="cancelBooking('@bookingReference')" style="padding: 12px 24px; font-size: 16px;">
                        ‚ùå ƒ∞ptal Et
                    </button>
                }
                
                <button class="btn btn-primary" onclick="downloadTicket('@bookingReference')" style="padding: 12px 24px; font-size: 16px;">
                    üìÑ Bilet ƒ∞ndir
                </button>
                
                <button class="btn btn-secondary" onclick="window.print()" style="padding: 12px 24px; font-size: 16px;">
                    üñ®Ô∏è Yazdƒ±r
                </button>
            </div>
        </div>
    }
    else
    {
        <!-- Model null ise Query sayfasƒ±na y√∂nlendir -->
        <div class="card">
            <div style="text-align: center; padding: 40px; color: #666;">
                <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;">üîç</div>
                <h4>Rezervasyon Bulunamadƒ±</h4>
                <p>Rezervasyon detaylarƒ± y√ºklenemedi. L√ºtfen PNR ve e-posta bilgilerinizi kontrol edin.</p>
                <a asp-action="Query" class="btn btn-primary" style="margin-top: 16px;">üîç Yeni Sorgulama Yap</a>
            </div>
        </div>
    }
</div>

<script>
    function processPayment(pnr) {
        window.location.href = '@Url.Action("Payment", "Booking")?pnr=' + pnr;
    }
    
    function cancelBooking(pnr) {
        if (confirm('‚ö†Ô∏è Rezervasyonunuzu iptal etmek istediƒüinizden emin misiniz?\nBu i≈ülem geri alƒ±namaz.')) {
            alert('‚ùå ƒ∞ptal i≈ülemi yakƒ±nda aktif olacaktƒ±r.\nPNR: ' + pnr);
        }
    }
    
    function downloadTicket(pnr) {
        alert('üìÑ Bilet indirme √∂zelliƒüi yakƒ±nda aktif olacaktƒ±r.\nPNR: ' + pnr);
    }
</script>

<style>
    .info-item {
        margin-bottom: 8px;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .info-item:last-child {
        border-bottom: none;
    }
    
    @@media (max-width: 768px) {
        .flight-info-grid {
            grid-template-columns: 1fr !important;
        }
    }
    
    @@media print {
        .btn {
            display: none !important;
        }
        
        body {
            background: white !important;
        }
        
        .card {
            box-shadow: none !important;
            border: 1px solid #ddd !important;
        }
    }
</style>