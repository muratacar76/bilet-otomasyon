@model List<object>

<div class="container">
    <div class="page-header">
        <h1>Rezervasyonlarım</h1>
        <p>Tüm rezervasyonlarınızı buradan görüntüleyebilir ve yönetebilirsiniz.</p>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">
            @TempData["Success"]
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-error">
            @TempData["Error"]
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="bookings-grid">
            @foreach (dynamic booking in Model)
            {
                <div class="booking-card">
                    <div class="booking-header">
                        <div class="booking-reference">
                            <strong>PNR: @booking.BookingReference</strong>
                            <span class="booking-status status-@booking.Status.ToString().ToLower()">
                                @(booking.Status == "Confirmed" ? (booking.IsPaid ? "Ödendi" : "Onaylandı") : 
                                  booking.Status == "Cancelled" ? "İptal Edildi" : booking.Status)
                            </span>
                        </div>
                        <div class="booking-date">
                            @booking.BookingDate.ToString("dd.MM.yyyy HH:mm")
                        </div>
                    </div>

                    <div class="flight-info">
                        <div class="flight-route">
                            <div class="departure">
                                <strong>@booking.Flight.DepartureCity</strong>
                                <div class="time">@booking.Flight.DepartureTime.ToString("dd.MM.yyyy HH:mm")</div>
                            </div>
                            <div class="flight-arrow">✈️</div>
                            <div class="arrival">
                                <strong>@booking.Flight.ArrivalCity</strong>
                                <div class="time">@booking.Flight.ArrivalTime.ToString("dd.MM.yyyy HH:mm")</div>
                            </div>
                        </div>
                        <div class="flight-details">
                            <span>@booking.Flight.FlightNumber - @booking.Flight.Airline</span>
                        </div>
                    </div>

                    <div class="passenger-info">
                        <h4>Yolcular (@booking.Passengers.Count kişi)</h4>
                        <div class="passengers-list">
                            @foreach (dynamic passenger in booking.Passengers)
                            {
                                <div class="passenger">
                                    <span>@passenger.FirstName @passenger.LastName</span>
                                    @if (!string.IsNullOrEmpty(passenger.SeatNumber))
                                    {
                                        <span class="seat">Koltuk: @passenger.SeatNumber</span>
                                    }
                                </div>
                            }
                        </div>
                    </div>

                    <div class="booking-footer">
                        <div class="price">
                            <strong>Toplam: @booking.TotalPrice.ToString("C", new System.Globalization.CultureInfo("tr-TR"))</strong>
                        </div>
                        <div class="actions">
                            <button class="btn btn-secondary" onclick="showBookingDetails('@booking.BookingReference')">
                                Detaylar
                            </button>
                            @if (booking.CanBeCancelled)
                            {
                                <button class="btn btn-danger" onclick="cancelBooking('@booking.Id', '@booking.BookingReference')">
                                    İptal Et
                                </button>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="no-bookings">
            <div class="no-bookings-icon">✈️</div>
            <h3>Henüz rezervasyonunuz bulunmuyor</h3>
            <p>İlk rezervasyonunuzu yapmak için uçuş aramaya başlayın.</p>
            <a asp-controller="Flight" asp-action="Search" class="btn btn-primary">Uçuş Ara</a>
        </div>
    }
</div>

<style>
.bookings-grid {
    display: grid;
    gap: 20px;
    margin-top: 20px;
}

.booking-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid #e0e0e0;
}

.booking-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #f0f0f0;
}

.booking-reference {
    display: flex;
    align-items: center;
    gap: 12px;
}

.booking-status {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.status-confirmed {
    background: #e8f5e8;
    color: #2e7d32;
}

.status-cancelled {
    background: #ffebee;
    color: #c62828;
}

.booking-date {
    color: #666;
    font-size: 14px;
}

.flight-info {
    margin-bottom: 20px;
}

.flight-route {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

.departure, .arrival {
    text-align: center;
}

.flight-arrow {
    font-size: 24px;
    color: #1976d2;
}

.time {
    font-size: 14px;
    color: #666;
    margin-top: 4px;
}

.flight-details {
    text-align: center;
    color: #666;
    font-size: 14px;
}

.passenger-info {
    margin-bottom: 20px;
}

.passenger-info h4 {
    margin-bottom: 10px;
    color: #333;
}

.passengers-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.passenger {
    background: #f5f5f5;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.seat {
    background: #1976d2;
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
}

.booking-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid #f0f0f0;
}

.price {
    font-size: 18px;
    color: #1976d2;
}

.actions {
    display: flex;
    gap: 10px;
}

.no-bookings {
    text-align: center;
    padding: 60px 20px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.no-bookings-icon {
    font-size: 48px;
    margin-bottom: 20px;
}

.no-bookings h3 {
    margin-bottom: 10px;
    color: #333;
}

.no-bookings p {
    color: #666;
    margin-bottom: 30px;
}

@@media (max-width: 768px) {
    .booking-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .flight-route {
        flex-direction: column;
        gap: 10px;
    }
    
    .booking-footer {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
    
    .actions {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
function showBookingDetails(pnr) {
    // Redirect to booking query with PNR
    window.location.href = '@Url.Action("Query", "Booking")?pnr=' + pnr;
}

function cancelBooking(bookingId, pnr) {
    if (confirm('Bu rezervasyonu iptal etmek istediğinizden emin misiniz?\n\nPNR: ' + pnr)) {
        fetch('/api/bookings/' + bookingId, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                alert(data.message);
                location.reload();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('İptal işlemi sırasında bir hata oluştu.');
        });
    }
}
</script>